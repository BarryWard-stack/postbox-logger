# Heritage Postbox v0.9.0 Integration Checklist
# ¬© 2025 Insight Geospatial, Eurotech Marine Data Services Ltd. All rights reserved.
# Author: Barry Ward (Primary Developer)
# Technical Architect: Gemini
# Last Modified: 2025-02-14 09:25:00
# Version: 1.0.0

## üéØ Integration Scope: Phase 1 PWA + Phase 2 Gamification Prep

---

## ‚úÖ TASK 1: PWA Icon Integration

### 1.1 File Deployment
- [ ] Copy `/icons/` directory to project root
- [ ] Verify all 10 sizes present (16-512px)
- [ ] Confirm `icon-192x192.png` and `icon-512x512.png` exist (maskable)

**Command:**
```bash
cp -r /mnt/user-data/outputs/icons [project-root]/icons/
ls -lh [project-root]/icons/icon-*.png | wc -l  # Should show 10
```

---

### 1.2 Manifest Integration
- [ ] Copy `manifest.json` to project root
- [ ] Verify `"purpose": "any maskable"` set for 192px and 512px only
- [ ] Confirm `theme_color: "#DC2626"` (Royal Mail Red)
- [ ] Validate JSON syntax: `jsonlint manifest.json`

**File:** `manifest.json`
```json
{
  "name": "Heritage Postbox Logger",
  "short_name": "Plogger",
  "theme_color": "#DC2626",
  "icons": [
    // ... 16-152px with "purpose": "any" ...
    {
      "src": "/icons/icon-192x192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any maskable"  // ‚úÖ Critical
    },
    {
      "src": "/icons/icon-512x512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any maskable"  // ‚úÖ Critical
    }
  ]
}
```

---

### 1.3 HTML <head> Synchronization

**Target File:** `heritage-postbox-v0_8_0-firebase.html`  
**Location:** Inside `<head>` section (after `<title>`)

**SURGICAL EDITS (Add these lines):**

```html
<!-- PWA Manifest -->
<link rel="manifest" href="/manifest.json">

<!-- Favicon Sizes -->
<link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png">

<!-- Apple Touch Icon (iOS) -->
<link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192x192.png">

<!-- Theme Color (Mobile Browser Chrome) -->
<meta name="theme-color" content="#DC2626">

<!-- Apple Mobile Web App -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Plogger">

<!-- Mobile Viewport (VERIFY existing tag matches) -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
```

**Checklist:**
- [ ] `<link rel="manifest">` added
- [ ] Favicon sizes 16px and 32px linked
- [ ] Apple touch icon points to 192px (not 180px - will auto-scale)
- [ ] `theme-color` = #DC2626 (Royal Mail Red)
- [ ] Apple mobile app meta tags present
- [ ] NO duplicate `<meta name="viewport">` tags (merge if exists)

---

## ‚úÖ TASK 2: Heritage Color Multipliers (Phase 2 Prep)

**Status:** Documentation ready, implementation deferred to v0.9.1+  
**Reason:** Requires photo verification system (Phase 3)

### 2.1 Code Review
- [ ] Review `/heritage-color-multipliers.js` implementation guide
- [ ] Locate existing `getRarityInfo()` in heritage-postbox-v0_8_0-firebase.html
- [ ] Confirm cipher-based logic (VR, EVIIIR, GR, etc.) is present

### 2.2 Data Structure Planning
- [ ] Add to Firestore schema planning doc:
  ```javascript
  {
    dominantColor: '#DC2626',        // Future: ML detection
    userTags: {
      hasAirmailBlue: false,
      hasBronzeGreen: false,
      hasSundayYellow: false,
      isDecommissioned: false
    },
    colorVariant: null,               // Populated when detected
    colorMultiplier: 1                // Default: no multiplier
  }
  ```

**No code changes required this sprint.** Bookmark for Phase 2.2 (Photo Verification).

---

## ‚úÖ TASK 3: Asset Pipeline Automation

### 3.1 Node.js Script Setup
- [ ] Install dependencies: `npm install sharp --save-dev`
- [ ] Copy `generate-pwa-icons.js` to project root
- [ ] Create `/masters/` directory for future 2048px icons
- [ ] Test script: `node generate-pwa-icons.js ./masters ./icons`

**Expected Output:**
```
üé® PWA Icon Generator v1.0.0
üìÇ Master Directory: ./masters
üìÇ Output Directory: ./icons
‚úÖ Generated: icon-16x16.png
‚úÖ Generated: icon-32x32.png
...
‚úÖ Generated: icon-512x512.png (maskable)
‚úÖ Complete: 10 sizes generated from british_postbox
```

### 3.2 Future Icon Batches
When Recraft usage resets, generate 2048px masters for:
- [ ] Lamp Box (Slim)
- [ ] Dual Aperture (Wide)
- [ ] Royal Cipher badges: VR, E VII R, GR, E VIII R, G VI R, E II R, C III R, Scottish Crown
- [ ] Special variants: Olympic Gold, Decommissioned, Airmail Blue, Victorian Bronze-Green

**CRITICAL:** Follow transparency verification workflow (see `ICON_TRANSPARENCY_VERIFICATION.md`)

**Process:**
1. Export from Recraft at 2048x2048px PNG
2. **VERIFY:** Run `identify -verbose [file] | grep Type` ‚Üí MUST show `TrueColorAlpha`
3. If shows `TrueColor` ‚Üí Apply conversion: `convert [file] -fuzz 15% -transparent white [output]`
4. Place verified files in `/masters/` directory with naming: `{type}_postbox_2048.png`
5. Run: `node generate-pwa-icons.js`
6. Verify 192px and 512px maskable sizes have TrueColorAlpha
7. Confirm 80% safe zone (1638px core graphic) in 2048px source

---

## ‚úÖ TASK 4: Testing & Validation

### 4.1 PWA Install Prompt (Mobile)
- [ ] Deploy to GitHub Pages
- [ ] Test on Android Chrome: Should show "Add to Home Screen"
- [ ] Test on iOS Safari: Share ‚Üí "Add to Home Screen"
- [ ] Verify icon appears correctly on home screen (no white borders)

### 4.2 Manifest Validation
- [ ] Use Lighthouse PWA audit in Chrome DevTools
- [ ] Check for manifest errors in Console
- [ ] Verify maskable icons render correctly in PWA tools

**Lighthouse PWA Checklist:**
- ‚úÖ Web app manifest meets installability requirements
- ‚úÖ Provides a valid apple-touch-icon
- ‚úÖ Configured for a custom splash screen
- ‚úÖ Sets a theme color

### 4.3 Offline Functionality (Phase 1.2)
- [ ] Test with DevTools ‚Üí Network ‚Üí Offline mode
- [ ] Verify IndexedDB queue stores unsaved postboxes
- [ ] Confirm Firebase sync on reconnection

**Deferred to v0.9.1:** Service Worker implementation for full offline caching.

---

## ‚úÖ TASK 5: Documentation Updates

### 5.1 Changelog Entry
Add to project changelog:

```markdown
## v0.9.0 (2025-02-15)

### PWA Foundation (Phase 1)
- FEAT: PWA manifest with 10 icon sizes (16-512px)
- FEAT: Maskable icon support (192px, 512px) with 80% safe zone
- FIX: Converted JPEG-as-PNG icons to true PNG-24 with alpha transparency
- FEAT: Royal Mail Red (#DC2626) theme color for mobile browsers
- FEAT: Apple mobile web app meta tags for iOS installation

### Gamification Prep (Phase 2)
- DOCS: Heritage color multiplier system designed (Bronze-Green 5x, Airmail Blue 10x, Sunday Yellow 3x, Decommissioned 2x)
- DOCS: Node.js asset pipeline automation script (sharp library)

### Technical Debt
- TODO: Implement service worker for offline caching (Phase 1.2)
- TODO: Integrate color multiplier logic with photo verification (Phase 2.2)
- TODO: Generate remaining 18 icon variants (Recraft usage limits)

### Known Issues
- Uploaded icons were 2000x2000px vs 2048px standard (minor scaling discrepancy)
- Future 2048px assets may show MIME errors as JPEG (ignore, they are PNG-24)
```

### 5.2 README Update
- [ ] Add "Install as App" section with screenshots
- [ ] Document icon generation workflow
- [ ] Update roadmap progress: Phase 1 ‚Üí 70% complete

---

## üìä Pre-Deployment Checklist

**Critical Path Items:**
- [ ] All 10 PWA icons deployed to `/icons/`
- [ ] `manifest.json` in project root with correct paths
- [ ] HTML `<head>` includes manifest link and theme color
- [ ] No console errors on page load
- [ ] PWA install prompt appears on mobile

**Nice-to-Have (Can defer):**
- [ ] Service worker for offline caching
- [ ] Color multiplier implementation
- [ ] Remaining 18 icon variants

---

## üéØ Next Session Goal

**From Gemini's Handoff:**
> "Finalize the 'Sky Blue' Blackpool Tower special badge and verify the offline IndexedDB queue for Phase 1.2."

**Interpreted Actions:**
1. Create Blackpool Tower landmark achievement badge (custom icon TBD)
2. Test IndexedDB offline queue logic
3. Verify Firebase sync on network reconnection

**Estimated Scope:** 8-12 tool calls (database schema updates, offline testing)

---

## üö® Compliance Reminders

### Surgical Precision Rules
- **DO:** Add new `<link>` and `<meta>` tags to `<head>`
- **DO:** Copy icon files to `/icons/` directory
- **DO:** Add manifest.json to root
- **DON'T:** Refactor existing JavaScript logic
- **DON'T:** Modify GUI layout or Leaflet map code
- **DON'T:** Change Firebase authentication flow

### Licensing
Every new file MUST include:
```javascript
// ¬© 2025 Insight Geospatial, Eurotech Marine Data Services Ltd. All rights reserved.
// Author: Barry Ward
// License: Proprietary - Not for redistribution without written consent.
```

### Version Control
- Update "Last Modified" timestamp in file headers
- Increment version: v0.8.0 ‚Üí v0.9.0
- Document all changes in changelog with FIX/FEAT/ROOT CAUSE format

---

## üìÅ Deliverables Summary

**Generated This Session:**
1. `/icons/` - 10 PWA sizes + 4 master PNGs (2000x2000px)
2. `manifest.json` - PWA manifest with maskable icon config
3. `generate-pwa-icons.js` - Node.js automation script (sharp library)
4. `heritage-color-multipliers.js` - Phase 2 implementation guide
5. `PWA_ICON_PROCESSING_SUMMARY.md` - Technical documentation

**All files ready in:** `/mnt/user-data/outputs/`

**No blocking issues. Ready for v0.9.0 integration.**
